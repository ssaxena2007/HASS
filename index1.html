<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Shorts Clone</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
        }

        .shorts-container {
            height: 100vh;
            width: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            -ms-overflow-style: none;  /* Hide scrollbar IE and Edge */
            scrollbar-width: none;  /* Hide scrollbar Firefox */
        }

        /* Hide scrollbar for Chrome/Safari/Opera */
        .shorts-container::-webkit-scrollbar {
            display: none;
        }

        .short-item {
            height: 100vh;
            width: 100%;
            position: relative;
            scroll-snap-align: start;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            z-index: 1;
        }

        .creator-info {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .creator-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .actions {
            position: absolute;
            right: 20px;
            bottom: 100px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .action-button {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .action-count {
            font-size: 14px;
        }

        .scroll-indicator {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .indicator-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }

        .indicator-dot.active {
            background: white;
            transform: scale(1.5);
        }

        /* ensure wrapper stacking so thumbnail sits on top until iframe loads */
        .video-wrapper { position: relative; width:100%; height:100%; }
        iframe.short-iframe {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
            background: #000;
            border: 0;
        }
        .video-wrapper img.thumb {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 2; /* above iframe until iframe finishes loading */
            transition: opacity 220ms ease;
            opacity: 1;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="shorts-container" id="shortsContainer">
        <!-- Shorts will be inserted here by JavaScript -->
    </div>
    <div class="scroll-indicator" id="scrollIndicator"></div>
    <script>
        const shortsContainer = document.getElementById('shortsContainer');
        const scrollIndicator = document.getElementById('scrollIndicator');

        let allData = [];
        let displayed = [];
        let nextIndex = 0;
        const INITIAL_COUNT = 5;
        const LOAD_COUNT = 3;

        // Fetch initial data
        fetch('./testdata/shorts_db.json')
            .then(r => r.json())
            .then(json => {
                allData = json;
                // start with the first INITIAL_COUNT items (or all if fewer)
                displayed = allData.slice(0, INITIAL_COUNT);
                nextIndex = displayed.length;
                renderShorts(displayed);
                updateScrollIndicator();
            });

        // create item markup (unchanged structure but now accepts full item object)
        function createShortItem(short) {
            const id = short.id;
            const title = short.snippet?.title || '';
            const description = short.snippet?.description || '';
            const channel = short.snippet?.channelTitle || '';
            const thumb = short.snippet?.thumbnails?.maxres?.url || '';

            // Two data-src values:
            // - data-src-play sets autoplay=1 (used for the currently-visible short)
            // - data-src-preload loads the iframe without autoplay (used to preload next short)
            const playUrl = `https://www.youtube.com/embed/${id}?rel=0&controls=0&modestbranding=1&autoplay=1&playsinline=1&loop=1&playlist=${id}`;
            const preloadUrl = `https://www.youtube.com/embed/${id}?rel=0&controls=0&modestbranding=1&playsinline=1&loop=1&playlist=${id}`;

            return `
                <div class="short-item">
                    <div class="video-wrapper">
                        <iframe
                            class="short-iframe"
                            data-video-id="${id}"
                            data-src-play="${playUrl}"
                            data-src-preload="${preloadUrl}"
                            allow="autoplay; encrypted-media"
                        ></iframe>

                        <!-- thumbnail sits above iframe until iframe loads -->
                        <img class="thumb" src="${thumb}" alt="${title}">
                    </div>

                    <div class="video-info">
                        <div class="creator-info">
                            <!---img src="https://via.placeholder.com/40" class="creator-avatar" alt="${channel}"--->
                            <div>
                                <h3>${channel}</h3>
                                <h2>${title}</h2>
                                <p>${description.split('\\n')[0] || ''}</p>
                            </div>
                        </div>
                    </div>

                    <div class="actions">
                        <button class="action-button">‚ù§Ô∏è<span class="action-count">0</span></button>
                        <button class="action-button">üí¨<span class="action-count">0</span></button>
                        <button class="action-button">üîó</button>
                    </div>
                </div>
            `;
        }

        
        